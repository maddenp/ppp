BIN=a.out
EXT=$(suffix $(TEST))
FC=gfortran
FFLAGS=-w
PPP=../../ppp
STEM=$(basename $(TEST))
TARGETS=bin clean control translation
TEST=$(wildcard t.f t.f90)
TRANSLATION=$(STEM)_ppp$(EXT)

.PHONY: control

default:
	$(error Valid targets are: $(TARGETS))

bin: $(BIN)

clean:
	$(RM) $(TRANSLATION) $(BIN)

control: $(TEST)
ifdef MAKE_CONTROL_DISABLED
	$(info Auto-generation of 'control' is disabled for test $(TEST), investigate...)
else
	$(FC) $(FFLAGS) $^ && a.out >control 2>&1 && $(RM) a.out
endif

translation: $(TRANSLATION)

$(BIN): $(TRANSLATION)
	$(FC) $(FFLAGS) $(TRANSLATION)

$(TRANSLATION): $(TEST)
	$(PPP) $(TEST) > $(TRANSLATION)
