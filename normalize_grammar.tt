grammar Normalize

  rule text
    ( directive / quoted / comment / unquoted )* <Text>
  end

  rule comment
    '!' [^\n]* <Delete>
  end

  rule directive
    # TODO need to recognize other (e.g. 'omp') directives
    sms
  end

  rule quoted
    ( '"' [^"]* '"' / "'" [^']* "'" )+ <Verbatim>
  end

  rule sms
    '!' [sS] [mM] [sS] '$' <Normalize>
  end

  rule unquoted
    [^'"!]+ <Normalize>
  end

end
